<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BWR - Bobertovo Web Resources</title>
    <link rel="stylesheet" href="main-style.css">
</head>
<body>
    <div class="page-container">
        <!-- Left Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>BWR</h1>
                <p class="subtitle">Bobertovo Web Resources</p>
            </div>
            
            <ul class="nav-menu">
                <li>
                    <a href="#marketplace" class="nav-link" data-section="marketplace">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        <span>Marketplace</span>
                    </a>
                </li>
                <li>
                    <a href="#wiki" class="nav-link" data-section="wiki">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        </svg>
                        <span>Wikipedia</span>
                    </a>
                </li>
                <li>
                    <a href="#findjob" class="nav-link" data-section="findjob">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                        </svg>
                        <span>Find Job</span>
                    </a>
                </li>
                <li>
                    <a href="#rentoffice" class="nav-link" data-section="rentoffice">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 21h18M5 21V7l8-4 8 4v14M8 21V12a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v9"></path>
                        </svg>
                        <span>Rent Office</span>
                    </a>
                </li>
                <li>
                    <a href="#sites" class="nav-link" data-section="sites">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="9" y1="3" x2="9" y2="21"></line>
                        </svg>
                        <span>Sites</span>
                    </a>
                </li>
            </ul>

            <div class="sidebar-footer">
                <a href="https://t.me/frtzhvk" target="_blank" class="contact-link">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                    </svg>
                    Contact BWR
                </a>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Marketplace Section -->
            <section id="marketplace-section" class="content-section">
                <iframe src="marketplace.html" class="content-frame"></iframe>
            </section>

            <!-- Wikipedia Section -->
            <section id="wiki-section" class="content-section">
                <iframe src="wikipedia.html" class="content-frame"></iframe>
            </section>

            <!-- Find Job Section -->
            <section id="findjob-section" class="content-section">
                <iframe src="marketplace.html#jobs" class="content-frame"></iframe>
            </section>

            <!-- Rent Office Section -->
            <section id="rentoffice-section" class="content-section">
                <div class="under-construction">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 9v4m0 4h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"></path>
                    </svg>
                    <h2>В разработке</h2>
                    <p>раздел Аренда Офисов скоро будет доступен</p>
                </div>
            </section>

            <!-- Sites Section -->
            <section id="sites-section" class="content-section active">
                <div class="sites-header">
                    <h2>Community Sites</h2>
                    <button id="addSiteBtn" class="add-site-btn">+ Add Site</button>
                </div>
                <div id="sites-grid" class="sites-grid">
                    <div class="loading">Loading sites...</div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Site Modal -->
    <div id="siteModal" class="modal" onclick="closeModalOnOutside(event, 'siteModal')">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Submit Your Site</h2>
                <button class="close-btn" onclick="closeModal('siteModal')">&times;</button>
            </div>
            <form id="siteForm">
                <div class="form-group">
                    <label>Site Name <span class="required">*</span></label>
                    <input type="text" id="site-name" required placeholder="Название сайта">
                </div>

                <div class="form-group">
                    <label>Description <span class="required">*</span></label>
                    <textarea id="site-description" required placeholder="Краткое описание сайта..."></textarea>
                </div>

                <div class="form-group">
                    <label>Preview Image URL <span class="required">*</span></label>
                    <input type="url" id="site-image" required placeholder="https://example.com/preview.jpg">
                </div>

                <div class="form-group">
                    <label>HTML File Name <span class="required">*</span></label>
                    <input type="text" id="site-file" required placeholder="mysite.html">
                    <small style="color: #8b949e; font-size: 12px; margin-top: 4px; display: block;">
                        First upload your .html file to the GitHub repository, then enter the filename here
                    </small>
                </div>

                <button type="submit" class="submit-btn">Submit Site</button>
            </form>
        </div>
    </div>

    <script>
        const GITHUB_USERNAME = 'Forretpw';
        const GITHUB_REPO = 'BWR';

        // Navigation handling
        function handleNavigation() {
            const hash = window.location.hash.slice(1) || 'sites';
            
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            const sectionMap = {
                'marketplace': 'marketplace-section',
                'wiki': 'wiki-section',
                'findjob': 'findjob-section',
                'rentoffice': 'rentoffice-section',
                'sites': 'sites-section'
            };
            
            const sectionId = sectionMap[hash] || 'sites-section';
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to current nav link
            const activeLink = document.querySelector(`[data-section="${hash}"]`);
            if (activeLink) activeLink.classList.add('active');
        }

        // Listen for hash changes
        window.addEventListener('hashchange', handleNavigation);
        window.addEventListener('load', handleNavigation);

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function closeModalOnOutside(e, modalId) {
            if (e.target.id === modalId) closeModal(modalId);
        }

        document.getElementById('addSiteBtn').addEventListener('click', () => {
            openModal('siteModal');
        });

        // Load and render sites
        async function loadSites() {
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/issues?labels=BWR-SITE&state=open`);
                const issues = await response.json();
                const container = document.getElementById('sites-grid');
                
                if (issues.length === 0) {
                    container.innerHTML = '<div class="loading">No sites yet. Click "+ Add Site" to submit the first one!</div>';
                    return;
                }
                
                container.innerHTML = issues.map(issue => {
                    const body = issue.body;
                    const name = body.match(/\*\*Name:\*\* (.+)/)?.[1] || 'Unknown Site';
                    const description = body.match(/\*\*Description:\*\*\s*\n(.+)/s)?.[1]?.trim() || '';
                    const image = body.match(/\*\*Image:\*\* (.+)/)?.[1] || '';
                    const file = body.match(/\*\*File:\*\* (.+)/)?.[1] || '';
                    
                    return `
                        <div class="site-card" onclick="window.location.hash='${file.replace('.html', '')}'">
                            <img src="${image}" alt="${name}" class="site-image" onerror="this.src='https://via.placeholder.com/300x200/0d1117/8b949e?text=No+Preview'">
                            <div class="site-content">
                                <div class="site-name">${name}</div>
                                <div class="site-description">${description}</div>
                                <div class="site-link">Visit Site →</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Add click handlers for site navigation
                addSiteNavigationHandlers(issues);
            } catch (error) {
                document.getElementById('sites-grid').innerHTML = '<div class="loading">Error loading sites.</div>';
            }
        }

        function addSiteNavigationHandlers(issues) {
            // When hash matches a site file, load it in iframe
            window.addEventListener('hashchange', () => {
                const hash = window.location.hash.slice(1);
                const site = issues.find(issue => {
                    const file = issue.body.match(/\*\*File:\*\* (.+)/)?.[1] || '';
                    return file.replace('.html', '') === hash;
                });
                
                if (site) {
                    const file = site.body.match(/\*\*File:\*\* (.+)/)?.[1];
                    const name = site.body.match(/\*\*Name:\*\* (.+)/)?.[1] || 'Site';
                    
                    // Hide all sections
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Create or update dynamic site section
                    let dynamicSection = document.getElementById('dynamic-site-section');
                    if (!dynamicSection) {
                        dynamicSection = document.createElement('section');
                        dynamicSection.id = 'dynamic-site-section';
                        dynamicSection.className = 'content-section';
                        document.querySelector('.main-content').appendChild(dynamicSection);
                    }
                    
                    dynamicSection.innerHTML = `<iframe src="${file}" class="content-frame" title="${name}"></iframe>`;
                    dynamicSection.classList.add('active');
                    
                    // Remove active from nav links
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                }
            });
        }

        // Submit site form
        document.getElementById('siteForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('site-name').value;
            const description = document.getElementById('site-description').value;
            const image = document.getElementById('site-image').value;
            const file = document.getElementById('site-file').value;

            const issueBody = `**Name:** ${name}\n**Description:**\n${description}\n**Image:** ${image}\n**File:** ${file}`;
            const issueUrl = `https://github.com/${GITHUB_USERNAME}/${GITHUB_REPO}/issues/new?title=${encodeURIComponent(name)}&body=${encodeURIComponent(issueBody)}&labels=BWR-SITE`;
            window.open(issueUrl, '_blank');
            closeModal('siteModal');
        });

        // Initialize
        loadSites();
    </script>
</body>
</html>
